<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configuration Initiale - PoolController</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      /* 2026 Ambient gradient - d√©satur√©, device UI feel */
      background: linear-gradient(135deg, #e8ecf4 0%, #dfe5f0 100%);
      background-attachment: fixed;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      position: relative;
    }

    /* Subtle grain/noise overlay for premium device feel */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0.035;
      z-index: 0;
      pointer-events: none;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    }

    .wizard-container {
      background: white;
      border-radius: 16px;
      /* 2026 Card System - √©l√©vation perceptible */
      border: 1px solid rgba(0, 0, 0, 0.1);
      box-shadow:
        0 12px 32px rgba(0, 0, 0, 0.12),
        0 4px 8px rgba(0, 0, 0, 0.08);
      max-width: 600px;
      width: 100%;
      overflow: hidden;
      position: relative;
      z-index: 1;
    }

    .wizard-header {
      /* 2026: Subtle branded header, less aggressive */
      background: linear-gradient(135deg, #5c7cdb 0%, #687ad8 100%);
      color: white;
      padding: 32px 30px 28px;
      text-align: center;
    }

    .wizard-header-logo {
      width: 48px;
      height: 48px;
      margin: 0 auto 16px;
      display: block;
    }

    .wizard-header h1 {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 6px;
      letter-spacing: -0.3px;
    }

    .wizard-header p {
      opacity: 0.85;
      font-size: 14px;
      font-weight: 400;
    }

    /* 2026 Minimal stepper with progress bar */
    .stepper {
      padding: 24px 30px 20px;
      background: #fafbfc;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    /* Top progress bar - minimal & modern */
    .stepper-progress {
      height: 3px;
      background: rgba(92, 124, 219, 0.12);
      border-radius: 999px;
      overflow: hidden;
      margin-bottom: 20px;
      position: relative;
    }

    .stepper-progress::after {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      background: linear-gradient(90deg, #5c7cdb 0%, #687ad8 100%);
      border-radius: 999px;
      transition: width 400ms cubic-bezier(0.4, 0, 0.2, 1);
      width: var(--progress, 0%);
    }

    /* Steps indicators - minimal */
    .step {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-right: 24px;
      opacity: 0.4;
      transition: opacity 200ms ease;
    }

    .step.active {
      opacity: 1;
    }

    .step.completed {
      opacity: 0.6;
    }

    .step-number {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: rgba(92, 124, 219, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 12px;
      color: #687ad8;
      transition: all 200ms ease;
    }

    .step.active .step-number {
      background: #5c7cdb;
      color: white;
      box-shadow: 0 2px 8px rgba(92, 124, 219, 0.3);
    }

    .step.completed .step-number {
      background: #15803d;
      color: white;
    }

    .step-label {
      font-size: 13px;
      font-weight: 500;
      color: #1a1d29;
    }

    .wizard-content {
      padding: 30px;
    }

    .step-content {
      display: none;
    }

    .step-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* 2026 Typography hierarchy */
    .step-title {
      font-size: 19px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #1a1d29;
      letter-spacing: -0.2px;
    }

    .step-description {
      color: #4b5563;
      margin-bottom: 24px;
      font-size: 14px;
      line-height: 1.5;
      font-weight: 400;
    }

    .field {
      margin-bottom: 20px;
    }

    .field label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #1a1d29;
      font-size: 13px;
      letter-spacing: -0.1px;
    }

    .field input,
    .field select {
      width: 100%;
      padding: 12px 14px;
      border: 1.5px solid #e5e7eb;
      border-radius: 10px;
      font-size: 14px;
      background: #fafbfc;
      transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    .field input:hover {
      border-color: #d1d5db;
      background: white;
    }

    .field input:focus,
    .field select:focus {
      outline: none;
      border-color: #5c7cdb;
      background: white;
      box-shadow: 0 0 0 3px rgba(92, 124, 219, 0.08);
    }

    /* 2026 Machine d'√©tats - PAS de rouge pendant typing */
    /* √âtat valid - apr√®s validation compl√®te */
    .field input.is-valid {
      border-color: #15803d;
      background: rgba(52, 199, 89, 0.02);
    }

    /* √âtat error - SEULEMENT apr√®s blur ou submit, JAMAIS pendant typing */
    .field input.is-error {
      border-color: #dc2626;
      background: rgba(255, 59, 48, 0.02);
    }

    /* Message d'erreur (cach√© par d√©faut) */
    .field__error {
      font-size: 12px;
      color: #dc2626;
      margin-top: 6px;
      display: none;
      animation: slideDown 0.2s ease;
    }

    .field.has-error .field__error {
      display: block;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .hint {
      font-size: 12px;
      color: #4b5563;
      margin-top: 4px;
    }

    /* 2026 Password strength checklist */
    .password-checklist {
      margin-top: 12px;
      padding: 12px;
      background: #f8f9fb;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .password-checklist-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #4b5563;
      margin-bottom: 6px;
      transition: color 200ms ease;
    }

    .password-checklist-item:last-child {
      margin-bottom: 0;
    }

    .password-checklist-item .icon {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 1.5px solid #d1d5db;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      transition: all 200ms ease;
    }

    .password-checklist-item.valid {
      color: #15803d;
    }

    .password-checklist-item.valid .icon {
      background: #15803d;
      border-color: #15803d;
      color: white;
    }

    .password-checklist-item.valid .icon::before {
      content: '‚úì';
    }

    /* Password strength indicator */
    .password-strength {
      margin-top: 12px;
      display: flex;
      gap: 4px;
      height: 4px;
    }

    .password-strength-bar {
      flex: 1;
      background: #e5e7eb;
      border-radius: 999px;
      transition: background 300ms ease;
    }

    .password-strength.weak .password-strength-bar:nth-child(1) {
      background: #dc2626;
    }

    .password-strength.medium .password-strength-bar:nth-child(1),
    .password-strength.medium .password-strength-bar:nth-child(2) {
      background: #ffcc00;
    }

    .password-strength.strong .password-strength-bar {
      background: #15803d;
    }

    .password-strength-label {
      margin-top: 6px;
      font-size: 12px;
      font-weight: 600;
      text-align: right;
      opacity: 0;
      transition: opacity 200ms ease;
    }

    .password-strength-label.visible {
      opacity: 1;
    }

    .password-strength.weak + .password-strength-label {
      color: #dc2626;
    }

    .password-strength.medium + .password-strength-label {
      color: #ffcc00;
    }

    .password-strength.strong + .password-strength-label {
      color: #15803d;
    }

    .info-box {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 16px;
      margin-bottom: 20px;
      border-radius: 4px;
    }

    .info-box strong {
      display: block;
      margin-bottom: 8px;
      color: #1976d2;
    }

    .info-box p {
      margin: 0;
      font-size: 14px;
      color: #555;
      line-height: 1.5;
    }

    .warning-box {
      background: #fff3e0;
      border-left: 4px solid #ff9800;
      padding: 16px;
      margin-bottom: 20px;
      border-radius: 4px;
    }

    .warning-box strong {
      display: block;
      margin-bottom: 8px;
      color: #f57c00;
    }

    .warning-box p {
      margin: 0;
      font-size: 14px;
      color: #555;
      line-height: 1.5;
    }

    .field.required label::after {
      content: ' *';
      color: #f44336;
    }

    /* 2026 Modern CTA buttons */
    /* 2026 Boutons - micro-polish CTA */
    .btn {
      padding: 13px 24px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      min-height: 44px;
    }

    /* √âtat focus - accessibilit√© */
    .btn:focus-visible {
      outline: 2px solid #5c7cdb;
      outline-offset: 2px;
    }

    /* √âtat disabled */
    .btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
      pointer-events: none;
    }

    /* Primary - CTA principal */
    .btn-primary {
      background: linear-gradient(135deg, #5c7cdb 0%, #687ad8 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(92, 124, 219, 0.2);
    }

    .btn-primary:hover:not(:disabled) {
      box-shadow: 0 4px 16px rgba(92, 124, 219, 0.35);
      transform: translateY(-2px);
    }

    .btn-primary:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 1px 4px rgba(92, 124, 219, 0.25);
    }

    .btn-primary:focus-visible {
      outline-color: #5c7cdb;
    }

    /* Secondary - actions secondaires */
    .btn-secondary {
      background: white;
      color: #1a1d29;
      border: 1.5px solid #e5e7eb;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
    }

    .btn-secondary:hover:not(:disabled) {
      background: #fafbfc;
      border-color: #d1d5db;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      transform: translateY(-1px);
    }

    .btn-secondary:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
    }

    .btn-secondary:focus-visible {
      outline-color: #6b7280;
    }

    /* Success - validation */
    .btn-success {
      background: linear-gradient(135deg, #15803d 0%, #166534 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(21, 128, 61, 0.25);
    }

    .btn-success:hover:not(:disabled) {
      box-shadow: 0 4px 16px rgba(21, 128, 61, 0.4);
      transform: translateY(-2px);
    }

    .btn-success:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 1px 4px rgba(21, 128, 61, 0.3);
    }

    .btn-success:focus-visible {
      outline-color: #15803d;
    }

    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .wizard-actions {
      display: flex;
      justify-content: space-between;
      padding: 20px 30px;
      border-top: 1px solid #e0e0e0;
      background: #f9f9f9;
    }

    .wizard-actions > :only-child {
      margin-left: auto;
    }

    .wizard-actions.align-right {
      justify-content: flex-end;
    }

    .hidden {
      display: none !important;
    }

    .alert {
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    .alert.show {
      display: block;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .alert-error {
      background: #ffebee;
      color: #c62828;
      border-left: 4px solid #f44336;
    }

    .alert-success {
      background: #e8f5e9;
      color: #2e7d32;
      border-left: 4px solid #15803d;
    }

    .network-list {
      border: 1px solid #ddd;
      border-radius: 6px;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 12px;
    }

    .network-item {
      padding: 12px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .network-item:last-child {
      border-bottom: none;
    }

    .network-item:hover {
      background: #f5f5f5;
    }

    .network-item.selected {
      background: #e3f2fd;
    }

    .network-item strong {
      display: block;
      margin-bottom: 4px;
    }

    .network-item small {
      color: #4b5563;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #4b5563;
    }

    .password-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }

    .password-wrapper input {
      padding-right: 44px;
    }

    .password-toggle {
      position: absolute;
      right: 12px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px;
      color: #666;
      font-size: 18px;
      line-height: 1;
      transition: color 0.2s ease;
    }

    .password-toggle:hover {
      color: #333;
    }
  </style>
</head>
<body>
  <div class="wizard-container">
    <div class="wizard-header">
      <img src="/apple-touch-icon.png" alt="PoolController" class="wizard-header-logo">
      <h1>Configuration Initiale</h1>
      <p>Bienvenue ! Configurons votre PoolController en 3 √©tapes</p>
    </div>

    <!-- Stepper -->
    <div class="stepper">
      <div class="stepper-progress" id="stepperProgress"></div>
      <div class="step active" data-step="1">
        <div class="step-number">1</div>
        <div class="step-label">Mot de passe</div>
      </div>
      <div class="step" data-step="2">
        <div class="step-number">2</div>
        <div class="step-label">Wi-Fi</div>
      </div>
      <div class="step" data-step="3">
        <div class="step-number">3</div>
        <div class="step-label">Heure</div>
      </div>
    </div>

    <!-- Content -->
    <div class="wizard-content">
      <!-- 2026 Accessible feedback messages -->
      <div class="alert alert-error" id="errorAlert" role="alert" aria-live="assertive" aria-atomic="true"></div>
      <div class="alert alert-success" id="successAlert" role="status" aria-live="polite" aria-atomic="true"></div>

      <!-- Step 1: Password -->
      <div class="step-content active" data-step="1">
        <div class="step-title">S√©curit√© de votre PoolController</div>
        <div class="step-description">
          D√©finissez un mot de passe administrateur s√©curis√© pour prot√©ger l'acc√®s √† votre installation.
        </div>

        <div class="info-box">
          <strong>üîí S√©curit√©</strong>
          <p>Ce mot de passe sera utilis√© pour vous connecter √† l'interface web et aux API. Choisissez un mot de passe fort d'au moins 8 caract√®res.</p>
        </div>

        <div class="field required">
          <label for="adminPassword">Mot de passe administrateur</label>
          <div class="password-wrapper">
            <input
              type="password"
              id="adminPassword"
              name="password"
              placeholder="Minimum 8 caract√®res"
              aria-describedby="passwordChecklist passwordStrength"
              autocomplete="new-password">
            <button
              type="button"
              class="password-toggle"
              data-target="adminPassword"
              aria-label="Afficher ou masquer le mot de passe"
              title="Afficher/Masquer">
              <svg class="eye-open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M2.5 12s3.6-6.5 9.5-6.5S21.5 12 21.5 12s-3.6 6.5-9.5 6.5S2.5 12 2.5 12z"/><circle cx="12" cy="12" r="2.6"/></svg>
              <svg class="eye-closed hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M3 12s3.4-6.5 9-6.5 9 6.5 9 6.5-3.4 6.5-9 6.5-9-6.5-9-6.5z"/><circle cx="12" cy="12" r="2.6"/><path d="M4 4l16 16"/></svg>
            </button>
          </div>

          <!-- 2026 Real-time validation checklist -->
          <div class="password-checklist" id="passwordChecklist" style="display: none;">
            <div class="password-checklist-item" data-rule="length">
              <span class="icon"></span>
              <span>Au moins 8 caract√®res</span>
            </div>
            <div class="password-checklist-item" data-rule="number">
              <span class="icon"></span>
              <span>Au moins 1 chiffre</span>
            </div>
            <div class="password-checklist-item" data-rule="special">
              <span class="icon"></span>
              <span>Au moins 1 caract√®re sp√©cial (!@#$%^&*)</span>
            </div>
          </div>

          <!-- Password strength indicator -->
          <div class="password-strength" id="passwordStrength" style="display: none;">
            <div class="password-strength-bar"></div>
            <div class="password-strength-bar"></div>
            <div class="password-strength-bar"></div>
            <div class="password-strength-bar"></div>
          </div>
          <div class="password-strength-label" id="passwordStrengthLabel"></div>
        </div>

        <div class="field required">
          <label for="adminPasswordConfirm">Confirmer le mot de passe</label>
          <div class="password-wrapper">
            <input
              type="password"
              id="adminPasswordConfirm"
              name="password-confirm"
              placeholder="Re-saisir le mot de passe"
              autocomplete="new-password">
            <button
              type="button"
              class="password-toggle"
              data-target="adminPasswordConfirm"
              aria-label="Afficher ou masquer la confirmation du mot de passe"
              title="Afficher/Masquer">
              <svg class="eye-open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M2.5 12s3.6-6.5 9.5-6.5S21.5 12 21.5 12s-3.6 6.5-9.5 6.5S2.5 12 2.5 12z"/><circle cx="12" cy="12" r="2.6"/></svg>
              <svg class="eye-closed hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M3 12s3.4-6.5 9-6.5 9 6.5 9 6.5-3.4 6.5-9 6.5-9-6.5-9-6.5z"/><circle cx="12" cy="12" r="2.6"/><path d="M4 4l16 16"/></svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Step 2: WiFi -->
      <div class="step-content" data-step="2">
        <div class="step-title">Connexion Wi-Fi</div>
        <div class="step-description">
          Connectez votre PoolController √† votre r√©seau Wi-Fi pour acc√©der aux fonctionnalit√©s en ligne.
        </div>

        <div class="info-box">
          <strong>‚ÑπÔ∏è Connexion optionnelle</strong>
          <p>La connexion Wi-Fi n'est pas obligatoire, mais elle offre de nombreux avantages :</p>
          <ul style="margin: 8px 0 0 20px; padding: 0;">
            <li>Mises √† jour automatiques du firmware</li>
            <li>Synchronisation automatique de l'heure via NTP</li>
            <li>Acc√®s √† distance √† l'interface web via <span style="font-weight: 600;">http://poolcontroller.local</span></li>
            <li>Publication des donn√©es via MQTT (optionnel)</li>
          </ul>
          <p style="margin-top: 8px;"><strong>Sans Wi-Fi :</strong> Vous devrez vous connecter au r√©seau AP du PoolController (<span style="font-weight: 600;">R√©seau Wifi PoolControllerAP</span>) et acc√©der √† l'interface via <span style="font-weight: 600;">http://192.168.4.1</span>, r√©gler l'heure manuellement et effectuer les mises √† jour par upload manuel.</p>
        </div>

        <div class="field">
          <label>R√©seaux Wi-Fi disponibles</label>
          <button type="button" class="btn btn-secondary" id="scanWifiBtn" style="width: 100%; margin-bottom: 12px;">
            üîç Scanner les r√©seaux
          </button>
          <div class="network-list hidden" id="networkList"></div>
          <div class="loading hidden" id="scanLoading">Scan en cours...</div>
        </div>

        <div class="field required" id="ssidField">
          <label>Nom du r√©seau (SSID)</label>
          <input type="text" id="wifiSsid" placeholder="S√©lectionnez ou saisissez le SSID">
        </div>

        <div class="field required" id="passwordField">
          <label>Mot de passe Wi-Fi</label>
          <div class="password-wrapper">
            <input type="password" id="wifiPassword" placeholder="Mot de passe du r√©seau">
            <button type="button" class="password-toggle" data-target="wifiPassword" title="Afficher/Masquer">
              <svg class="eye-open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.5 12s3.6-6.5 9.5-6.5S21.5 12 21.5 12s-3.6 6.5-9.5 6.5S2.5 12 2.5 12z"/><circle cx="12" cy="12" r="2.6"/></svg>
              <svg class="eye-closed hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12s3.4-6.5 9-6.5 9 6.5 9 6.5-3.4 6.5-9 6.5-9-6.5-9-6.5z"/><circle cx="12" cy="12" r="2.6"/><path d="M4 4l16 16"/></svg>
            </button>
          </div>
        </div>

        <div class="field">
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="checkbox" id="skipWifi" style="width: auto; margin-right: 8px;">
            <span>Ignorer la configuration Wi-Fi (configurer plus tard)</span>
          </label>
        </div>
      </div>

      <!-- Step 3: Time -->
      <div class="step-content" data-step="3">
        <div class="step-title">Configuration de l'heure</div>
        <div class="step-description">
          Configurez l'heure de votre PoolController pour les fonctionnalit√©s programmables.
        </div>

        <div class="warning-box">
          <strong>‚è∞ Importance de l'heure</strong>
          <p>L'heure est essentielle pour :</p>
          <ul style="margin: 8px 0 0 20px; padding: 0;">
            <li><strong>Programmation de la filtration</strong> : Horaires de d√©marrage/arr√™t automatiques</li>
            <li><strong>Programmation de l'√©clairage</strong> : Allumage/extinction selon l'heure</li>
            <li><strong>Historique des mesures</strong> : Horodatage des relev√©s de temp√©rature, pH et ORP</li>
            <li><strong>Logs syst√®me</strong> : Tra√ßabilit√© des √©v√©nements</li>
          </ul>
        </div>

        <div class="info-box hidden" id="ntpDisabledInfo">
          <strong>‚ÑπÔ∏è NTP d√©sactiv√©</strong>
          <p>Aucune connexion Wi-Fi configur√©e. L'heure doit √™tre r√©gl√©e manuellement.</p>
        </div>

        <div class="field required">
          <label>Mode de configuration</label>
          <select id="timeMode">
            <option value="ntp">Automatique (NTP) - N√©cessite une connexion Internet</option>
            <option value="manual">Manuel - R√©glage manuel de l'heure</option>
          </select>
        </div>

        <div id="ntpConfig" class="hidden">
          <div class="field">
            <label>Serveur NTP</label>
            <input type="text" id="ntpServer" value="pool.ntp.org" placeholder="pool.ntp.org">
            <div class="hint">Serveur de temps pour la synchronisation automatique</div>
          </div>

          <div class="field">
            <label>Fuseau horaire</label>
            <select id="timezone">
              <option value="europe_paris" selected>Europe/Paris (CET/CEST)</option>
              <option value="utc">UTC</option>
              <option value="america_new_york">America/New_York (EST/EDT)</option>
            </select>
          </div>
        </div>

        <div id="manualTimeConfig" class="hidden">
          <div class="field required">
            <label>Date et heure</label>
            <input type="datetime-local" id="manualTime" required>
            <div class="hint">S√©lectionnez la date et l'heure actuelles</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="wizard-actions">
      <button type="button" class="btn btn-secondary hidden" id="prevBtn">‚Üê Pr√©c√©dent</button>
      <button type="button" class="btn btn-primary" id="nextBtn">Suivant ‚Üí</button>
      <button type="button" class="btn btn-success hidden" id="finishBtn">Terminer la configuration</button>
    </div>
  </div>

  <script>
    let currentStep = 1;
    let wifiConfigured = false;

    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const finishBtn = document.getElementById('finishBtn');
    const errorAlert = document.getElementById('errorAlert');
    const successAlert = document.getElementById('successAlert');

    function showError(message) {
      errorAlert.textContent = message;
      errorAlert.classList.add('show');
      successAlert.classList.remove('show');
      setTimeout(() => errorAlert.classList.remove('show'), 5000);
    }

    function showSuccess(message) {
      successAlert.textContent = message;
      successAlert.classList.add('show');
      errorAlert.classList.remove('show');
    }

    function setButtonLoading(button, loading, originalText) {
      if (loading) {
        button.disabled = true;
        button.dataset.originalText = button.innerHTML;
        button.innerHTML = `<span class="spinner"></span><span>${originalText || 'Traitement...'}</span>`;
      } else {
        button.disabled = false;
        button.innerHTML = button.dataset.originalText || originalText || 'Suivant ‚Üí';
      }
    }

    function updateStepper() {
      // Update steps
      document.querySelectorAll('.step').forEach(step => {
        const stepNum = parseInt(step.dataset.step);
        step.classList.remove('active', 'completed');
        if (stepNum === currentStep) {
          step.classList.add('active');
        } else if (stepNum < currentStep) {
          step.classList.add('completed');
        }
      });

      // Update content
      document.querySelectorAll('.step-content').forEach(content => {
        content.classList.remove('active');
        if (parseInt(content.dataset.step) === currentStep) {
          content.classList.add('active');
        }
      });

      // Update progress bar (2026 style with CSS variable)
      const progress = ((currentStep - 1) / 2) * 100;
      const progressBar = document.getElementById('stepperProgress');
      if (progressBar) {
        progressBar.style.setProperty('--progress', `${progress}%`);
      }

      // Update buttons
      prevBtn.classList.toggle('hidden', currentStep === 1);
      nextBtn.classList.toggle('hidden', currentStep === 3);
      finishBtn.classList.toggle('hidden', currentStep !== 3);

      // Aligner les boutons √† droite sur l'√©tape 1
      const wizardActions = document.querySelector('.wizard-actions');
      wizardActions.classList.toggle('align-right', currentStep === 1);

      return true;
    }

    // 2026 Real-time password validation
    function checkPasswordStrength(password) {
      const rules = {
        length: password.length >= 8,
        number: /\d/.test(password),
        special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
      };

      const validCount = Object.values(rules).filter(Boolean).length;
      let strength = 'weak';
      if (validCount === 3) strength = 'strong';
      else if (validCount >= 2) strength = 'medium';

      return { rules, strength };
    }

    // 2026 Machine d'√©tats: JAMAIS rouge pendant typing
    function updatePasswordFeedback() {
      const password = document.getElementById('adminPassword').value;
      const checklist = document.getElementById('passwordChecklist');
      const strengthBar = document.getElementById('passwordStrength');
      const strengthLabel = document.getElementById('passwordStrengthLabel');
      const input = document.getElementById('adminPassword');

      if (password.length > 0) {
        checklist.style.display = 'block';
        strengthBar.style.display = 'flex';

        const { rules, strength } = checkPasswordStrength(password);

        // Update checklist items
        Object.keys(rules).forEach(rule => {
          const item = checklist.querySelector(`[data-rule="${rule}"]`);
          if (item) {
            item.classList.toggle('valid', rules[rule]);
          }
        });

        // Update strength bar
        strengthBar.className = `password-strength ${strength}`;

        // Update strength label text (Faible / Moyen / Fort)
        const strengthText = {
          weak: 'Faible',
          medium: 'Moyen',
          strong: 'Fort'
        };
        strengthLabel.textContent = strengthText[strength];
        strengthLabel.classList.add('visible');

        // ‚úÖ SEULEMENT marquer comme valid, JAMAIS rouge pendant typing
        const allValid = Object.values(rules).every(Boolean);
        if (allValid) {
          input.classList.add('is-valid');
          input.classList.remove('is-error');
        } else {
          // Pendant typing: rester neutre (gris/bleu)
          input.classList.remove('is-valid', 'is-error');
        }
      } else {
        checklist.style.display = 'none';
        strengthBar.style.display = 'none';
        strengthLabel.classList.remove('visible');
        input.classList.remove('is-valid', 'is-error');
      }

      // Update next button state
      updateNextButtonState();
    }

    function updateNextButtonState() {
      if (currentStep !== 1) return;

      const password = document.getElementById('adminPassword').value;
      const confirm = document.getElementById('adminPasswordConfirm').value;
      const { rules } = checkPasswordStrength(password);
      const allValid = Object.values(rules).every(Boolean);
      const passwordsMatch = password === confirm && password.length > 0;

      nextBtn.disabled = !(allValid && passwordsMatch);
    }

    // 2026 Validation avec messages factuels, non anxiog√®nes
    function validateStep1() {
      const password = document.getElementById('adminPassword').value;
      const confirm = document.getElementById('adminPasswordConfirm').value;

      const { rules } = checkPasswordStrength(password);
      const allValid = Object.values(rules).every(Boolean);

      if (!allValid) {
        // Message factuel, indique ce qu'il manque
        const missing = [];
        if (!rules.length) missing.push('8 caract√®res minimum');
        if (!rules.number) missing.push('1 chiffre');
        if (!rules.special) missing.push('1 caract√®re sp√©cial');
        showError(`Mot de passe incomplet: ${missing.join(', ')}`);
        return false;
      }

      if (password !== confirm) {
        // Message factuel, non alarmiste
        showError('Les deux mots de passe doivent √™tre identiques');
        return false;
      }

      return true;
    }

    async function saveStep1() {
      const password = document.getElementById('adminPassword').value;

      console.log('saveStep1 - d√©but');

      try {
        const response = await fetch('/auth/change-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            currentPassword: 'admin',
            newPassword: password
          })
        });

        console.log('saveStep1 - response status:', response.status);

        if (!response.ok) {
          const data = await response.json();
          console.error('saveStep1 - erreur:', data.error);
          throw new Error(data.error || 'Erreur lors de la configuration du mot de passe');
        }

        const data = await response.json();
        console.log('saveStep1 - succ√®s, token re√ßu');
        // Stocker le token pour les prochaines requ√™tes
        sessionStorage.setItem('authToken', data.token);
        return true;
      } catch (error) {
        console.error('saveStep1 - exception:', error);
        showError(error.message);
        return false;
      }
    }

    async function saveStep2() {
      const skipWifi = document.getElementById('skipWifi').checked;

      if (skipWifi) {
        // Si l'utilisateur d√©cide d'ignorer le WiFi, effacer toute configuration WiFi existante
        try {
          const response = await authFetch('/wifi/disconnect', {
            method: 'POST'
          });
          if (response.ok) {
            systemLogger.info('Configuration WiFi effac√©e');
          }
        } catch (error) {
          console.error('Erreur lors de l\'effacement de la config WiFi:', error);
          // On continue quand m√™me, ce n'est pas bloquant
        }
        wifiConfigured = false;
        return true;
      }

      const ssid = document.getElementById('wifiSsid').value;
      const password = document.getElementById('wifiPassword').value;

      if (!ssid) {
        showError('Veuillez s√©lectionner ou saisir un r√©seau Wi-Fi');
        return false;
      }

      if (ssid.length > 32) {
        showError('Le nom du r√©seau (SSID) ne peut pas d√©passer 32 caract√®res');
        return false;
      }

      if (password.length > 63) {
        showError('Le mot de passe Wi-Fi ne peut pas d√©passer 63 caract√®res');
        return false;
      }

      try {
        const response = await authFetch('/wifi/connect', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ssid, password })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Erreur de connexion Wi-Fi');
        }

        wifiConfigured = true;
        return true;
      } catch (error) {
        showError(error.message);
        return false;
      }
    }

    async function saveStep3() {
      const timeMode = document.getElementById('timeMode').value;

      const config = {
        time_use_ntp: timeMode === 'ntp',
        timezone_id: timeMode === 'ntp' ?
          document.getElementById('timezone').value : 'europe_paris',
        ntp_server: timeMode === 'ntp' ?
          document.getElementById('ntpServer').value : 'pool.ntp.org'
      };

      if (timeMode === 'manual') {
        const manualTime = document.getElementById('manualTime').value;
        if (!manualTime) {
          showError('Veuillez d√©finir la date et l\'heure');
          return false;
        }
        config.time_value = manualTime;
      }

      try {
        const response = await authFetch('/save-config', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(config)
        });

        if (!response.ok) {
          throw new Error('Erreur lors de la sauvegarde de la configuration');
        }

        return true;
      } catch (error) {
        showError(error.message);
        return false;
      }
    }

    function authFetch(url, options = {}) {
      const token = sessionStorage.getItem('authToken');
      if (token) {
        options.headers = options.headers || {};
        options.headers['X-Auth-Token'] = token;
      }
      return fetch(url, options);
    }

    async function scanWifi() {
      const scanBtn = document.getElementById('scanWifiBtn');
      const networkList = document.getElementById('networkList');
      const scanLoading = document.getElementById('scanLoading');

      setButtonLoading(scanBtn, true, 'Scan en cours...');
      scanLoading.classList.remove('hidden');
      networkList.classList.add('hidden');
      networkList.innerHTML = '';

      try {
        const response = await fetch('/wifi/scan');
        if (!response.ok) throw new Error('Erreur lors du scan Wi-Fi');

        const data = await response.json();
        const networks = data.networks || [];

        if (networks.length > 0) {
          networks.forEach(network => {
            const item = document.createElement('div');
            item.className = 'network-item';
            item.innerHTML = `
              <strong>${network.ssid}</strong>
              <small>Signal: ${network.rssi} dBm | ${network.encryption ? 'S√©curis√©' : 'Ouvert'}</small>
            `;
            item.onclick = () => {
              document.querySelectorAll('.network-item').forEach(i => i.classList.remove('selected'));
              item.classList.add('selected');
              document.getElementById('wifiSsid').value = network.ssid;
            };
            networkList.appendChild(item);
          });
          networkList.classList.remove('hidden');
        } else {
          showError('Aucun r√©seau Wi-Fi trouv√©');
        }
      } catch (error) {
        showError(error.message);
      } finally {
        setButtonLoading(scanBtn, false, 'üîç Scanner les r√©seaux');
        scanLoading.classList.add('hidden');
      }
    }

    // Event Listeners
    prevBtn.onclick = () => {
      if (currentStep > 1) {
        currentStep--;
        updateStepper();
      }
    };

    nextBtn.onclick = async () => {
      console.log('nextBtn clicked - currentStep:', currentStep);

      // Activer le spinner sur le bouton
      setButtonLoading(nextBtn, true, 'Traitement...');

      try {
        if (currentStep === 1) {
          console.log('Validation √©tape 1...');
          if (!validateStep1()) {
            console.log('Validation √©chou√©e');
            setButtonLoading(nextBtn, false);
            return;
          }
          console.log('Validation r√©ussie, sauvegarde...');
          if (!await saveStep1()) {
            console.log('Sauvegarde √©chou√©e');
            setButtonLoading(nextBtn, false);
            return;
          }
          console.log('Sauvegarde r√©ussie');
        } else if (currentStep === 2) {
          if (!await saveStep2()) {
            setButtonLoading(nextBtn, false);
            return;
          }
        }

        currentStep++;
        console.log("Passage √† l'√©tape:", currentStep);
        updateStepper();

        // D√©sactiver le spinner
        setButtonLoading(nextBtn, false);
      } catch (error) {
        console.error('Erreur lors du traitement:', error);
        setButtonLoading(nextBtn, false);
        showError('Une erreur est survenue');
      }

      // Update time mode availability based on WiFi config
      if (currentStep === 3) {
        const timeMode = document.getElementById('timeMode');
        const ntpDisabledInfo = document.getElementById('ntpDisabledInfo');
        if (!wifiConfigured) {
          // Pas de WiFi configur√© -> forcer le mode manuel
          timeMode.value = 'manual';
          timeMode.disabled = true;
          ntpDisabledInfo.classList.remove('hidden');
          document.getElementById('ntpConfig').classList.add('hidden');
          document.getElementById('manualTimeConfig').classList.remove('hidden');
          // Initialiser l'heure actuelle
          initializeManualTime();
        } else {
          // WiFi configur√© -> activer le mode NTP par d√©faut
          timeMode.value = 'ntp';
          timeMode.disabled = false;
          ntpDisabledInfo.classList.add('hidden');
          document.getElementById('ntpConfig').classList.remove('hidden');
          document.getElementById('manualTimeConfig').classList.add('hidden');
        }
      }
    };

      finishBtn.onclick = async () => {
      // Activer le spinner sur le bouton
      setButtonLoading(finishBtn, true, 'Finalisation...');

      try {
        if (!await saveStep3()) {
          setButtonLoading(finishBtn, false);
          return;
        }

        // Marquer le wizard comme compl√©t√© (d√©sactive le flag firstBoot)
        try {
          const response = await authFetch('/auth/complete-wizard', {
            method: 'POST'
          });
          if (!response.ok) {
            console.error('Erreur lors de la finalisation du wizard');
          }
        } catch (error) {
          console.error('Erreur lors de la finalisation du wizard:', error);
        }

        // Si WiFi configur√©, v√©rifier la connexion avant de red√©marrer
        if (wifiConfigured) {
          const mdnsBase = 'http://poolcontroller.local';

          // Mettre √† jour le bouton pour indiquer la v√©rification en cours
          setButtonLoading(finishBtn, true, 'V√©rification WiFi...');
          showSuccess('V√©rification de la connexion WiFi en cours...');

          // Attendre que l'ESP32 tente de se connecter et v√©rifier le statut
          const maxAttempts = 20;
          let connected = false;

          for (let i = 0; i < maxAttempts; i++) {
            await new Promise(resolve => setTimeout(resolve, 1000));

            try {
              const statusRes = await authFetch('/wifi/status');
              if (statusRes.ok) {
                const status = await statusRes.json();
                if (status.connected) {
                  connected = true;
                  break;
                }
              }
            } catch (e) {
              // Ignorer les erreurs de polling
            }
          }

          // Si la connexion a √©chou√©, proposer √† l'utilisateur de reconfigurer ou continuer en AP
          if (!connected) {
            errorAlert.innerHTML = `
              <div style="margin-bottom: 16px;">
                <strong>‚ùå √âchec de la connexion WiFi</strong>
                <p style="margin: 8px 0 0 0;">Impossible de se connecter au r√©seau WiFi configur√©.</p>
              </div>
              <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <button onclick="retryWifiConfig()" style="flex: 1; padding: 12px; background: #2196f3; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; min-width: 200px;">
                  üîÑ Reconfigurer le WiFi
                </button>
                <button onclick="continueWithoutWifi()" style="flex: 1; padding: 12px; background: #ff9800; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; min-width: 200px;">
                  ‚úì Continuer en mode AP
                </button>
              </div>
            `;
            errorAlert.classList.add('show');

            // Remettre le bouton √† son √©tat d√©sactiv√© avec le texte original
            finishBtn.disabled = true;
            finishBtn.innerHTML = 'Terminer la configuration';
            return;
          }

          // Connexion WiFi r√©ussie, continuer avec le red√©marrage
          showSuccess('Configuration termin√©e avec succ√®s !');

        // D√©sactiver le mode AP et d√©clencher le red√©marrage
        try {
          console.log('Appel /wifi/ap/disable pour red√©marrage...');

          // Appeler l'API qui va red√©marrer l'ESP32
          const response = await authFetch('/wifi/ap/disable', {
            method: 'POST'
          });

          console.log('R√©ponse /wifi/ap/disable - status:', response.status);

          if (response.ok) {
            const data = await response.json();
            console.log('Red√©marrage d√©clench√©:', data);
          }
        } catch (error) {
          // L'erreur est normale car l'ESP32 red√©marre et coupe la connexion
          console.log('Connexion perdue (ESP32 en cours de red√©marrage):', error);
        }

        // Redirection simple sans v√©rification CORS
        const redirectToMdns = async () => {
          // Instructions pour l'utilisateur
          let countdown = 15; // 15 secondes pour laisser le temps √† l'ESP32 de red√©marrer

          const updateInstructions = () => {
            const instructions = `
              <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 16px; margin: 20px 0; border-radius: 4px;">
                <strong style="display: block; margin-bottom: 8px; color: #1976d2;">üì° Configuration termin√©e !</strong>
                <ol style="margin: 8px 0 0 20px; padding: 0; font-size: 14px; color: #555; line-height: 1.6;">
                  <li><strong>Connectez-vous au r√©seau WiFi configur√©</strong> (si ce n'est pas d√©j√† fait)</li>
                  <li>L'ESP32 red√©marre en mode WiFi uniquement</li>
                  <li>Redirection automatique vers <strong>http://poolcontroller.local</strong> dans <strong>${countdown} secondes</strong></li>
                </ol>
                <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #90caf9;">
                  <button onclick="window.location.href='${mdnsBase}'" style="width: 100%; padding: 12px; background: #2196f3; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;">
                    üöÄ Acc√©der maintenant √† PoolController
                  </button>
                  <p style="margin: 8px 0 0 0; font-size: 12px; color: #666; text-align: center;">
                    Cliquez si vous √™tes d√©j√† connect√© au WiFi configur√©
                  </p>
                </div>
              </div>
            `;
            successAlert.innerHTML = instructions;
            successAlert.classList.add('show');
          };

          // Afficher les instructions initiales
          updateInstructions();

          // Compte √† rebours avec mise √† jour visuelle
          const countdownInterval = setInterval(() => {
            countdown--;
            if (countdown > 0) {
              updateInstructions();
            } else {
              clearInterval(countdownInterval);
              showSuccess('Redirection vers PoolController...');
              // Redirection directe sans v√©rification (pas de probl√®me CORS)
              setTimeout(() => {
                window.location.href = mdnsBase;
              }, 500);
            }
          }, 1000);
        };

        redirectToMdns();
      } else {
        // Pas de WiFi configur√©, rester en mode AP
        showSuccess('Configuration termin√©e avec succ√®s ! Redirection...');
        setTimeout(() => {
          window.location.href = '/';
        }, 2000);
      }
    } catch (error) {
      console.error('Erreur lors de la finalisation:', error);
      setButtonLoading(finishBtn, false);
      showError('Une erreur est survenue lors de la finalisation');
    }
  };

    document.getElementById('scanWifiBtn').onclick = scanWifi;

    document.getElementById('skipWifi').onchange = (e) => {
      const disabled = e.target.checked;
      document.getElementById('ssidField').style.opacity = disabled ? 0.5 : 1;
      document.getElementById('passwordField').style.opacity = disabled ? 0.5 : 1;
      document.getElementById('wifiSsid').disabled = disabled;
      document.getElementById('wifiPassword').disabled = disabled;
      document.getElementById('scanWifiBtn').disabled = disabled;
    };

    document.getElementById('timeMode').onchange = (e) => {
      const isNtp = e.target.value === 'ntp';
      document.getElementById('ntpConfig').classList.toggle('hidden', !isNtp);
      document.getElementById('manualTimeConfig').classList.toggle('hidden', isNtp);

      // Initialiser le champ date/heure avec l'heure actuelle lors du passage en mode manuel
      if (!isNtp) {
        initializeManualTime();
      }
    };

    // Fonction pour initialiser le champ date/heure avec l'heure actuelle
    function initializeManualTime() {
      const manualTimeInput = document.getElementById('manualTime');
      if (!manualTimeInput.value) {
        // Formater la date actuelle au format datetime-local (YYYY-MM-DDTHH:MM)
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');

        manualTimeInput.value = `${year}-${month}-${day}T${hours}:${minutes}`;
      }
    }

    // Password toggle handlers
    document.querySelectorAll('.password-toggle').forEach(btn => {
      btn.addEventListener('click', () => {
        const targetId = btn.dataset.target;
        const input = document.getElementById(targetId);
        const eyeOpen = btn.querySelector('.eye-open');
        const eyeClosed = btn.querySelector('.eye-closed');
        if (input.type === 'password') {
          input.type = 'text';
          eyeOpen.classList.add('hidden');
          eyeClosed.classList.remove('hidden');
        } else {
          input.type = 'password';
          eyeOpen.classList.remove('hidden');
          eyeClosed.classList.add('hidden');
        }
      });
    });

    // Fonction globale pour retourner √† la configuration WiFi
    window.retryWifiConfig = function() {
      errorAlert.classList.remove('show');
      currentStep = 2;
      updateStepper();
    };

    // Fonction globale pour continuer sans WiFi
    window.continueWithoutWifi = async function() {
      errorAlert.classList.remove('show');

      // Marquer WiFi comme non configur√©
      wifiConfigured = false;

      // D√©connecter le WiFi et effacer la configuration pour revenir en mode AP uniquement
      try {
        showSuccess('D√©connexion WiFi et passage en mode AP...');
        const response = await authFetch('/wifi/disconnect', {
          method: 'POST'
        });
        if (response.ok) {
          console.log('WiFi d√©connect√©, passage en mode AP');
        }
      } catch (error) {
        console.error('Erreur lors de la d√©connexion WiFi:', error);
        // On continue quand m√™me, ce n'est pas bloquant
      }

      // Marquer le wizard comme compl√©t√©
      try {
        await authFetch('/auth/complete-wizard', {
          method: 'POST'
        });
      } catch (error) {
        console.error('Erreur lors de la finalisation du wizard:', error);
      }

      // Rester en mode AP, rediriger vers l'interface principale
      showSuccess('Configuration termin√©e en mode AP. Redirection...');
      setTimeout(() => {
        window.location.href = '/';
      }, 2000);
    };

    // 2026 Machine d'√©tats - validation apr√®s blur
    function validatePasswordOnBlur() {
      const password = document.getElementById('adminPassword').value;
      const input = document.getElementById('adminPassword');

      // Si vide, reset
      if (password.length === 0) {
        input.classList.remove('is-valid', 'is-error');
        return;
      }

      const { rules } = checkPasswordStrength(password);
      const allValid = Object.values(rules).every(Boolean);

      // Apr√®s blur: montrer erreur si invalide
      if (!allValid) {
        input.classList.add('is-error');
        input.classList.remove('is-valid');
      }
    }

    function validateConfirmPasswordOnBlur() {
      const password = document.getElementById('adminPassword').value;
      const confirm = document.getElementById('adminPasswordConfirm').value;
      const input = document.getElementById('adminPasswordConfirm');

      // Si vide, reset
      if (confirm.length === 0) {
        input.classList.remove('is-valid', 'is-error');
        return;
      }

      // Apr√®s blur: montrer erreur si pas match
      if (password !== confirm) {
        input.classList.add('is-error');
        input.classList.remove('is-valid');
      } else if (password === confirm && password.length > 0) {
        input.classList.add('is-valid');
        input.classList.remove('is-error');
      }
    }

    // 2026 Real-time password validation listeners
    const adminPasswordInput = document.getElementById('adminPassword');
    const adminPasswordConfirmInput = document.getElementById('adminPasswordConfirm');

    if (adminPasswordInput) {
      // input: feedback neutre en temps r√©el
      adminPasswordInput.addEventListener('input', updatePasswordFeedback);
      // blur: validation avec potentiel √©tat error
      adminPasswordInput.addEventListener('blur', validatePasswordOnBlur);
      // focus: reset l'erreur pour permettre correction
      adminPasswordInput.addEventListener('focus', () => {
        adminPasswordInput.classList.remove('is-error');
      });
    }

    if (adminPasswordConfirmInput) {
      adminPasswordConfirmInput.addEventListener('input', updateNextButtonState);
      adminPasswordConfirmInput.addEventListener('blur', validateConfirmPasswordOnBlur);
      adminPasswordConfirmInput.addEventListener('focus', () => {
        adminPasswordConfirmInput.classList.remove('is-error');
      });
    }

    // Initialize
    updateStepper();
  </script>
</body>
</html>
